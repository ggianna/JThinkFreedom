package org.scify.jthinkfreedom.gui.forms;

import java.awt.GridBagConstraints;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JOptionPane;
import org.scify.jthinkfreedom.gui.model.Configuration;
import org.scify.jthinkfreedom.gui.model.User;
import org.scify.jthinkfreedom.gui.utils.ConfigurationHandler;
import org.scify.jthinkfreedom.reactors.SlideShowReactor;

/**
 *
 * @author peustr
 */
public class ProfileScreen extends javax.swing.JFrame {

    private static final int STEP = 4;

    private int profilePaginationCounterStart = 0;
    private int profilePaginationCounterEnd = STEP;

    private int configurationPaginationCounterStart = 0;
    private int configurationPaginationCounterEnd = STEP;

    private ConfigurationHandler cf;
    private List<ProfilePanel> profiles;
    private List<ConfigurationPanel> configurations;

    private User selectedUser;

    /**
     * Creates new form ProfileScreen
     */
    public ProfileScreen() {
        initComponents();
    }

    public ProfileScreen(ConfigurationHandler cf) {
        this.cf = cf;
        initComponents();
        initCustomComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPopupMenu1 = new javax.swing.JPopupMenu();
        contentPane = new javax.swing.JPanel();
        logoLabel = new javax.swing.JLabel();
        titleLabel = new javax.swing.JLabel();
        descriptionScrollPane = new javax.swing.JScrollPane();
        descriptionTextPane = new javax.swing.JTextPane();
        nextProfileButton = new javax.swing.JButton();
        previousProfileButton = new javax.swing.JButton();
        profileCountLabel = new javax.swing.JLabel();
        profilePanel = new javax.swing.JPanel();
        configurationTitleLabel = new javax.swing.JLabel();
        previousConfigurationButton = new javax.swing.JButton();
        nextConfigurationButton = new javax.swing.JButton();
        configurationPanel = new javax.swing.JPanel();
        addProfileButton = new javax.swing.JButton();
        runButton = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Think Freedom");

        contentPane.setBackground(new java.awt.Color(255, 255, 255));
        contentPane.setPreferredSize(new java.awt.Dimension(800, 720));

        logoLabel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/scify/jthinkfreedom/gui/resources/logo_100x59.png"))); // NOI18N

        titleLabel.setFont(new java.awt.Font("Comfortaa", 1, 24)); // NOI18N
        titleLabel.setText("SciFY Supportive Technologies");

        descriptionTextPane.setEditable(false);
        descriptionTextPane.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(51, 51, 51)));
        descriptionTextPane.setFont(new java.awt.Font("Comfortaa", 0, 12)); // NOI18N
        descriptionTextPane.setText("Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris id ipsum tempor, lobortis magna sed, fringilla lectus. Nam id condimentum velit. Maecenas vel augue porta, luctus magna id, sollicitudin quam. Proin venenatis tincidunt commodo. Duis quis pharetra magna, ut placerat metus. Nulla erat arcu, dictum non risus at, faucibus fermentum odio. Duis mattis erat nec magna maximus elementum. Nunc massa leo, feugiat non odio eu, accumsan vestibulum nibh. Quisque scelerisque ligula ut purus rutrum, ut posuere mauris auctor. Aliquam elementum dolor eget velit efficitur finibus venenatis ut nulla. Morbi varius massa sed odio viverra, id auctor diam posuere.");
        descriptionScrollPane.setViewportView(descriptionTextPane);

        nextProfileButton.setFont(new java.awt.Font("Comfortaa", 0, 10)); // NOI18N
        nextProfileButton.setText(">");
        nextProfileButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nextProfileButtonActionPerformed(evt);
            }
        });

        previousProfileButton.setFont(new java.awt.Font("Comfortaa", 0, 10)); // NOI18N
        previousProfileButton.setText("<");
        previousProfileButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                previousProfileButtonActionPerformed(evt);
            }
        });

        profileCountLabel.setFont(new java.awt.Font("Comfortaa", 1, 14)); // NOI18N
        profileCountLabel.setText("n profiles");

        profilePanel.setBackground(new java.awt.Color(255, 255, 255));
        profilePanel.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED, new java.awt.Color(204, 204, 204), new java.awt.Color(102, 102, 102), null, null));
        profilePanel.setLayout(new java.awt.GridBagLayout());

        configurationTitleLabel.setFont(new java.awt.Font("Comfortaa", 1, 14)); // NOI18N
        configurationTitleLabel.setText("No configuration selected");

        previousConfigurationButton.setFont(new java.awt.Font("Comfortaa", 0, 10)); // NOI18N
        previousConfigurationButton.setText("<");
        previousConfigurationButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                previousConfigurationButtonActionPerformed(evt);
            }
        });

        nextConfigurationButton.setFont(new java.awt.Font("Comfortaa", 0, 10)); // NOI18N
        nextConfigurationButton.setText(">");
        nextConfigurationButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nextConfigurationButtonActionPerformed(evt);
            }
        });

        configurationPanel.setBackground(new java.awt.Color(255, 255, 255));
        configurationPanel.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED, new java.awt.Color(204, 204, 204), new java.awt.Color(102, 102, 102), null, null));
        configurationPanel.setLayout(new java.awt.GridBagLayout());

        addProfileButton.setFont(new java.awt.Font("Comfortaa", 1, 14)); // NOI18N
        addProfileButton.setText("Add new profile");
        addProfileButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addProfileButtonActionPerformed(evt);
            }
        });

        runButton.setFont(new java.awt.Font("Comfortaa", 1, 14)); // NOI18N
        runButton.setText("Run");
        runButton.setEnabled(false);
        runButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                runButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout contentPaneLayout = new javax.swing.GroupLayout(contentPane);
        contentPane.setLayout(contentPaneLayout);
        contentPaneLayout.setHorizontalGroup(
            contentPaneLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(contentPaneLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(contentPaneLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(profilePanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(descriptionScrollPane, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, contentPaneLayout.createSequentialGroup()
                        .addComponent(profileCountLabel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(runButton)
                        .addGap(29, 29, 29)
                        .addComponent(addProfileButton)
                        .addGap(18, 18, 18)
                        .addComponent(previousProfileButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(nextProfileButton))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, contentPaneLayout.createSequentialGroup()
                        .addComponent(configurationTitleLabel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(previousConfigurationButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(nextConfigurationButton))
                    .addGroup(contentPaneLayout.createSequentialGroup()
                        .addComponent(logoLabel)
                        .addGap(18, 18, 18)
                        .addComponent(titleLabel)
                        .addGap(0, 248, Short.MAX_VALUE))
                    .addComponent(configurationPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        contentPaneLayout.setVerticalGroup(
            contentPaneLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(contentPaneLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(contentPaneLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(titleLabel)
                    .addComponent(logoLabel))
                .addGap(13, 13, 13)
                .addComponent(descriptionScrollPane, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(contentPaneLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(profileCountLabel)
                    .addComponent(previousProfileButton)
                    .addComponent(nextProfileButton)
                    .addComponent(addProfileButton)
                    .addComponent(runButton, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(profilePanel, javax.swing.GroupLayout.DEFAULT_SIZE, 185, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addGroup(contentPaneLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(configurationTitleLabel)
                    .addComponent(previousConfigurationButton)
                    .addComponent(nextConfigurationButton))
                .addGap(18, 18, 18)
                .addComponent(configurationPanel, javax.swing.GroupLayout.DEFAULT_SIZE, 184, Short.MAX_VALUE)
                .addGap(49, 49, 49))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(contentPane, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(contentPane, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(0, 0, 0))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void previousProfileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_previousProfileButtonActionPerformed
        if (profilePaginationCounterStart - STEP >= 0) {
            profilePaginationCounterStart -= STEP;
            profilePaginationCounterEnd -= STEP;
            repaintProfiles();
        }
    }//GEN-LAST:event_previousProfileButtonActionPerformed

    private void nextProfileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nextProfileButtonActionPerformed
        if (profilePaginationCounterEnd < profiles.size()) {
            profilePaginationCounterEnd += STEP;
            profilePaginationCounterStart += STEP;
            repaintProfiles();
        }
    }//GEN-LAST:event_nextProfileButtonActionPerformed

    private void previousConfigurationButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_previousConfigurationButtonActionPerformed
        if (configurationPaginationCounterStart - STEP >= 0) {
            configurationPaginationCounterStart -= STEP;
            configurationPaginationCounterEnd -= STEP;
            repaintConfigurations(selectedUser);
        }
    }//GEN-LAST:event_previousConfigurationButtonActionPerformed

    private void nextConfigurationButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nextConfigurationButtonActionPerformed
        if (configurationPaginationCounterEnd < configurations.size()) {
            configurationPaginationCounterEnd += STEP;
            configurationPaginationCounterStart += STEP;
            repaintConfigurations(selectedUser);
        }
    }//GEN-LAST:event_nextConfigurationButtonActionPerformed

    private void addProfileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addProfileButtonActionPerformed
        CreateUserScreen cus = new CreateUserScreen(this);
        cus.setLocationRelativeTo(null);
        cus.setVisible(true);
    }//GEN-LAST:event_addProfileButtonActionPerformed

    private void runButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_runButtonActionPerformed
        /*Message to confirm button when showing images*/
        for (Configuration config : selectedUser.getConfigurations()) {
            config.getSensor().addStimulus(config.getStimulus());
            config.getStimulus().addSensor(config.getSensor());
            config.getStimulus().addReactor(config.getReactor());
            if (config.getReactor() instanceof SlideShowReactor) {
                JOptionPane.showMessageDialog(this, "Press Space to start :)");
            }
            config.getSensor().start();
            runButton.setEnabled(false);
        }
        
        //setVisible(false);
       
        
    }//GEN-LAST:event_runButtonActionPerformed

    private void initCustomComponents() {
        profilePaginationCounterStart = 0;
        profilePaginationCounterEnd = STEP;
        configurationPaginationCounterStart = 0;
        configurationPaginationCounterEnd = STEP;
        // Grid bag layout manager fill from left to right
        gbc = new GridBagConstraints();
        gbc.anchor = GridBagConstraints.WEST;
        gbc.weightx = 1;
        // Fill the profile panel according to pagination
        profiles = new ArrayList<>();
        for (User profile : cf.getProfiles()) {
            profiles.add(new ProfilePanel(this, profile));
        }
        repaintProfiles();
        configurations = new ArrayList<>();
        // Pack the fuck up
        pack();
    }

    public ConfigurationHandler getConfigurationHandler() {
        return cf;
    }

    public List<ProfilePanel> getProfiles() {
        return profiles;
    }

    public void setProfiles(List<ProfilePanel> profiles) {
        this.profiles = profiles;
    }

    public List<ConfigurationPanel> getConfigurations() {
        return configurations;
    }

    public void setConfigurations(List<ConfigurationPanel> configurations) {
        this.configurations = configurations;
    }

    public User getSelectedUser() {
        return selectedUser;
    }

    public void setSelectedUser(User selectedUser) {
        this.selectedUser = selectedUser;
    }

    public void removeUser(User selectedUser) {
        cf.deleteUser(selectedUser);
        repaintProfiles();
        for (ProfilePanel p : profiles) {
            if (p.getUser().equals(selectedUser)) {
                profiles.remove(p);
                break;
            }
        } 
        repaintProfiles();
        
        //profiles.remove(cf);

    }

    public void repaintProfiles() {
        profilePanel.removeAll();
        if (!profiles.isEmpty()) {
            profileCountLabel.setText(profiles.size() + " profiles");
            for (int i = profilePaginationCounterStart; i < profilePaginationCounterEnd; i++) {
                try {
                    profilePanel.add(profiles.get(i), gbc);
                } catch (IndexOutOfBoundsException e) {
                    // Do nothing
                }
            }
        }
        pack();
        profilePanel.repaint();
    }

    public void repaintConfigurations(User user) {
        configurationTitleLabel.setText("Currently displaying configuration for " + user.getName());
        configurationPanel.removeAll();
        if (!configurations.isEmpty()) {
            for (int i = configurationPaginationCounterStart; i < configurationPaginationCounterEnd; i++) {
                try {
                    configurationPanel.add(configurations.get(i), gbc);
                } catch (IndexOutOfBoundsException e) {
                    // Do nothing
                }
            }
        }
        /* */

        runButton.setEnabled(true);
        pack();
        configurationPanel.repaint();
    }

    private GridBagConstraints gbc;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton addProfileButton;
    private javax.swing.JPanel configurationPanel;
    private javax.swing.JLabel configurationTitleLabel;
    private javax.swing.JPanel contentPane;
    private javax.swing.JScrollPane descriptionScrollPane;
    private javax.swing.JTextPane descriptionTextPane;
    private javax.swing.JPopupMenu jPopupMenu1;
    private javax.swing.JLabel logoLabel;
    private javax.swing.JButton nextConfigurationButton;
    private javax.swing.JButton nextProfileButton;
    private javax.swing.JButton previousConfigurationButton;
    private javax.swing.JButton previousProfileButton;
    private javax.swing.JLabel profileCountLabel;
    private javax.swing.JPanel profilePanel;
    private javax.swing.JButton runButton;
    private javax.swing.JLabel titleLabel;
    // End of variables declaration//GEN-END:variables
}
