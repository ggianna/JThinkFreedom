package org.scify.jthinkfreedom.talkandplay.gui.configuration;

import java.io.IOException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;
import org.scify.jthinkfreedom.talkandplay.gui.ConfigurationFrame;
import org.scify.jthinkfreedom.talkandplay.gui.MainFrame;
import org.scify.jthinkfreedom.talkandplay.gui.helpers.GuiHelper;
import org.scify.jthinkfreedom.talkandplay.models.User;
import org.scify.jthinkfreedom.talkandplay.models.sensors.KeyboardSensor;
import org.scify.jthinkfreedom.talkandplay.models.sensors.MouseSensor;
import org.scify.jthinkfreedom.talkandplay.models.sensors.Sensor;
import org.scify.jthinkfreedom.talkandplay.services.UserService;

public class GeneralSettingsPanel extends javax.swing.JPanel {

    private User user;
    private UserService userService;
    private ConfigurationFrame configurationFrame;
    private MainFrame mainFrame;
    private GuiHelper guiHelper;
    private String userImage;
    private Sensor selectionSensor;
    private Sensor navigationSensor;

    /**
     * Creates new form ConfigurationPanel
     */
    public GeneralSettingsPanel(ConfigurationFrame configurationFrame, MainFrame mainFrame) {
        this.configurationFrame = configurationFrame;
        this.mainFrame = mainFrame;
        this.userService = new UserService();
        this.guiHelper = new GuiHelper();
        initComponents();
        initCustomComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        generalSettingsPanel = new javax.swing.JPanel();
        profileNameLabel = new javax.swing.JLabel();
        profileNameField = new javax.swing.JTextField();
        imageLabel = new javax.swing.JLabel();
        uploadImageButton = new javax.swing.JButton();
        rotationSpeedLabel = new javax.swing.JLabel();
        rotationSpeedTextField = new javax.swing.JTextField();
        errorLabel = new javax.swing.JLabel();
        preselectedCheckbox = new javax.swing.JCheckBox();
        jLabel1 = new javax.swing.JLabel();
        gridRowsTextField = new javax.swing.JTextField();
        gridColumnsTextField = new javax.swing.JTextField();
        deleteButton = new javax.swing.JButton();
        saveButton = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        navigationTextField = new javax.swing.JTextField();
        selectionTextField = new javax.swing.JTextField();

        setBackground(new java.awt.Color(255, 255, 255));

        generalSettingsPanel.setBackground(new java.awt.Color(255, 255, 255));
        generalSettingsPanel.setForeground(new java.awt.Color(255, 255, 255));
        generalSettingsPanel.setMinimumSize(new java.awt.Dimension(100, 20));

        profileNameLabel.setText("Όνομα προφίλ:");

        profileNameField.setMinimumSize(new java.awt.Dimension(100, 23));

        imageLabel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/scify/jthinkfreedom/talkandplay/resources/no-photo.png"))); // NOI18N

        uploadImageButton.setBackground(new java.awt.Color(255, 255, 255));
        uploadImageButton.setForeground(new java.awt.Color(51, 51, 51));
        uploadImageButton.setText("Αλλαγή εικόνας");
        uploadImageButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                uploadImageButtonActionPerformed(evt);
            }
        });

        rotationSpeedLabel.setText("Ταχύτητα scanning:");

        rotationSpeedTextField.setMinimumSize(new java.awt.Dimension(100, 23));
        rotationSpeedTextField.setPreferredSize(new java.awt.Dimension(100, 23));

        errorLabel.setFont(new java.awt.Font("Dialog", 1, 10)); // NOI18N
        errorLabel.setForeground(new java.awt.Color(204, 0, 0));
        errorLabel.setText("Παρακαλώ συμπληρώστε σωστά όλα τα πεδία");

        preselectedCheckbox.setBackground(new java.awt.Color(255, 255, 255));
        preselectedCheckbox.setForeground(new java.awt.Color(51, 51, 51));
        preselectedCheckbox.setText("Προεπιλεγμένο προφίλ");

        jLabel1.setText("Προεπιλεγμένο μέγεθος πίνακα:");

        gridRowsTextField.setPreferredSize(new java.awt.Dimension(30, 23));
        gridRowsTextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                gridRowsTextFieldActionPerformed(evt);
            }
        });

        gridColumnsTextField.setPreferredSize(new java.awt.Dimension(30, 23));
        gridColumnsTextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                gridColumnsTextFieldActionPerformed(evt);
            }
        });

        deleteButton.setBackground(new java.awt.Color(255, 255, 255));
        deleteButton.setForeground(new java.awt.Color(51, 51, 51));
        deleteButton.setText("Διαγραφή");
        deleteButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deleteButtonActionPerformed(evt);
            }
        });

        saveButton.setBackground(new java.awt.Color(255, 255, 255));
        saveButton.setForeground(new java.awt.Color(51, 51, 51));
        saveButton.setText("Αποθήκευση");
        saveButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveButtonActionPerformed(evt);
            }
        });

        jLabel2.setText("Κουμπί επιλογής:");

        jLabel3.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        jLabel3.setText("Ρυθμίσεις κουμπιών");

        jLabel4.setText("Κουμπί πλοήγησης:");

        navigationTextField.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                navigationTextFieldMouseClicked(evt);
            }
        });
        navigationTextField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                navigationTextFieldKeyPressed(evt);
            }
        });

        selectionTextField.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                selectionTextFieldMouseClicked(evt);
            }
        });
        selectionTextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectionTextFieldActionPerformed(evt);
            }
        });
        selectionTextField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                selectionTextFieldKeyPressed(evt);
            }
        });

        javax.swing.GroupLayout generalSettingsPanelLayout = new javax.swing.GroupLayout(generalSettingsPanel);
        generalSettingsPanel.setLayout(generalSettingsPanelLayout);
        generalSettingsPanelLayout.setHorizontalGroup(
            generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, generalSettingsPanelLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(deleteButton)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(saveButton))
                    .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(imageLabel)
                            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                                .addGap(6, 6, 6)
                                .addComponent(uploadImageButton)))
                        .addGap(18, 18, 18)
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                                .addComponent(jLabel2)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(selectionTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 44, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jLabel3)
                            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                                .addComponent(jLabel4)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(navigationTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 44, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                                .addComponent(profileNameLabel)
                                .addGap(49, 49, 49)
                                .addComponent(profileNameField, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                                .addComponent(rotationSpeedLabel)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(rotationSpeedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                                .addComponent(jLabel1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(gridRowsTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(gridColumnsTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(preselectedCheckbox)
                            .addComponent(errorLabel))
                        .addGap(0, 19, Short.MAX_VALUE)))
                .addContainerGap())
        );
        generalSettingsPanelLayout.setVerticalGroup(
            generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(profileNameLabel)
                            .addComponent(profileNameField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(rotationSpeedLabel)
                            .addComponent(rotationSpeedTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel1)
                            .addComponent(gridRowsTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(gridColumnsTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(preselectedCheckbox)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(errorLabel))
                    .addComponent(imageLabel))
                .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(uploadImageButton))
                    .addGroup(generalSettingsPanelLayout.createSequentialGroup()
                        .addGap(22, 22, 22)
                        .addComponent(jLabel3)
                        .addGap(8, 8, 8)
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel2)
                            .addComponent(selectionTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel4)
                            .addComponent(navigationTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 28, Short.MAX_VALUE)
                .addGroup(generalSettingsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(saveButton)
                    .addComponent(deleteButton))
                .addGap(16, 16, 16))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(generalSettingsPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(generalSettingsPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

    private void saveButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveButtonActionPerformed

        if (profileNameField.getText().isEmpty()) {
            errorLabel.setVisible(true);
        } else if (Integer.parseInt(gridRowsTextField.getText()) < 2 || Integer.parseInt(gridColumnsTextField.getText()) < 2) {
            errorLabel.setText("min 2x2");
            errorLabel.setVisible(true);
        } else {
            errorLabel.setVisible(false);

            User updatedUser = new User(profileNameField.getText(), this.userImage);
            updatedUser.setPreselected(preselectedCheckbox.isSelected());
            updatedUser.getConfiguration().setDefaultGridRow(Integer.parseInt(gridRowsTextField.getText()));
            updatedUser.getConfiguration().setDefaultGridColumn(Integer.parseInt(gridColumnsTextField.getText()));
            updatedUser.getConfiguration().setNavigationSensor(navigationSensor);
            updatedUser.getConfiguration().setSelectionSensor(selectionSensor);

            try {
                updatedUser = userService.update(updatedUser, user.getName());
            } catch (Exception ex) {
                Logger.getLogger(GeneralSettingsPanel.class.getName()).log(Level.SEVERE, null, ex);
            }

            configurationFrame.updateUsersList(profileNameField.getText());

            mainFrame.updateProfilesPanel(updatedUser, user.getName());
        }
    }//GEN-LAST:event_saveButtonActionPerformed

    private void deleteButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_deleteButtonActionPerformed

        int dialogResult = JOptionPane.showConfirmDialog(null, "Είστε σίγουροι ότι θέλετε να διαγράψετε το προφίλ?", "Warning", 0);
        if (dialogResult == JOptionPane.YES_OPTION) {
            try {
                userService.delete(new User(profileNameField.getText()));
            } catch (Exception ex) {
                Logger.getLogger(GeneralSettingsPanel.class.getName()).log(Level.SEVERE, null, ex);
            }
            configurationFrame.removeFromUsersList();
            mainFrame.removeFromProfilesPanel(user.getName());
        }
    }//GEN-LAST:event_deleteButtonActionPerformed

    private void uploadImageButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_uploadImageButtonActionPerformed
        userImage = "";
        JFileChooser chooser = new JFileChooser();

        chooser.setDialogTitle("Διαλέξτε εικόνα");
        chooser.setAcceptAllFileFilterUsed(false);
        chooser.setFileFilter(new FileNameExtensionFilter("Image Files", "png", "jpg", "jpeg", "JPG", "JPEG", "gif"));
        chooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
        if (chooser.showOpenDialog(null) == JFileChooser.APPROVE_OPTION) {
            userImage = chooser.getSelectedFile().getAbsolutePath();
            imageLabel.setIcon(guiHelper.getIcon(userImage));
        }
    }//GEN-LAST:event_uploadImageButtonActionPerformed

    private void gridRowsTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_gridRowsTextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_gridRowsTextFieldActionPerformed

    private void gridColumnsTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_gridColumnsTextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_gridColumnsTextFieldActionPerformed

    private void selectionTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectionTextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_selectionTextFieldActionPerformed

    private void selectionTextFieldKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_selectionTextFieldKeyPressed
        selectionSensor = new KeyboardSensor(evt.getKeyCode(), evt.getKeyChar(), "keyboard");
    }//GEN-LAST:event_selectionTextFieldKeyPressed

    private void navigationTextFieldKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_navigationTextFieldKeyPressed
        navigationSensor = new KeyboardSensor(evt.getKeyCode(), evt.getKeyChar(), "keyboard");
    }//GEN-LAST:event_navigationTextFieldKeyPressed

    private void navigationTextFieldMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_navigationTextFieldMouseClicked
        navigationSensor = new MouseSensor(evt.getButton(), evt.getClickCount(), "mouse");
    }//GEN-LAST:event_navigationTextFieldMouseClicked

    private void selectionTextFieldMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_selectionTextFieldMouseClicked
        selectionSensor = new MouseSensor(evt.getButton(), evt.getClickCount(), "mouse");
    }//GEN-LAST:event_selectionTextFieldMouseClicked

    private void initCustomComponents() {
        hideElements();
    }

    public void repaintSettings(User user) throws IOException {
        deleteButton.setVisible(true);
        saveButton.setVisible(true);
        profileNameField.setVisible(true);
        profileNameLabel.setVisible(true);
        imageLabel.setVisible(true);
        rotationSpeedLabel.setVisible(true);
        rotationSpeedTextField.setVisible(true);
        uploadImageButton.setVisible(true);
        preselectedCheckbox.setVisible(true);
        gridColumnsTextField.setVisible(true);
        gridRowsTextField.setVisible(true);

        imageLabel.setIcon(guiHelper.getIcon(user.getImage()));

        profileNameField.setText(user.getName());
        rotationSpeedTextField.setText(String.valueOf(user.getConfiguration().getRotationSpeed()));
        preselectedCheckbox.setSelected(user.isPreselected());
        gridRowsTextField.setText(String.valueOf(user.getConfiguration().getDefaultGridRow()));
        gridColumnsTextField.setText(String.valueOf(user.getConfiguration().getDefaultGridColumn()));

        this.user = user;
    }

    public void hideElements() {
        deleteButton.setVisible(false);
        saveButton.setVisible(false);
        profileNameField.setVisible(false);
        profileNameLabel.setVisible(false);
        imageLabel.setVisible(false);
        rotationSpeedLabel.setVisible(false);
        rotationSpeedTextField.setVisible(false);
        uploadImageButton.setVisible(false);
        errorLabel.setVisible(false);
        preselectedCheckbox.setVisible(false);
        gridColumnsTextField.setVisible(false);
        gridRowsTextField.setVisible(false);
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton deleteButton;
    private javax.swing.JLabel errorLabel;
    private javax.swing.JPanel generalSettingsPanel;
    private javax.swing.JTextField gridColumnsTextField;
    private javax.swing.JTextField gridRowsTextField;
    private javax.swing.JLabel imageLabel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JTextField navigationTextField;
    private javax.swing.JCheckBox preselectedCheckbox;
    private javax.swing.JTextField profileNameField;
    private javax.swing.JLabel profileNameLabel;
    private javax.swing.JLabel rotationSpeedLabel;
    private javax.swing.JTextField rotationSpeedTextField;
    private javax.swing.JButton saveButton;
    private javax.swing.JTextField selectionTextField;
    private javax.swing.JButton uploadImageButton;
    // End of variables declaration//GEN-END:variables
}
